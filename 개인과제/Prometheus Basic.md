# Prometheus 학습



## Basic



#### Metric 수집

- 중앙 서버가 메트릭을 Pull하는 방식
  - Pulling : 수집 대상 서버에서 데이터를 긁어감
- Service Discovery 기능으로 중앙 서버가 Metric을 수집할 서버들의 목록을 관리
  - Service Discovery : 특정 시스템이 현재 기동중인 서비스들의 목록과 IP주소를 가지고 있는 방식
- Exporter는 모니터링 에이전트로 타겟 시스템에서 메트릭을 읽어서 Prometheus가 Pulling 할 수 있도록 함.  또한, 단순히 `HTTP GET`으로 Metric을 `텍스트` 형태로 프로메테우스에 리턴하는데 단순 데이터 리턴일뿐 Exporter 자체는 기존값을 저장하는 기능은 없음
- Retrieval은 Service Discovery 시스템으로 모니터링 대상목록을 받아오고, Exporter로부터 주기적으로 대상의 Metrice을 수집하는 모듈



#### 저장

- 프로메테우스 내의 `메모리`와 `로컬 디스크`에 저장됨
- DB사용하는 것이 아니라 로컬 디스크에 저장하는데 설치, 사용은 쉽지만 스케일링이 불가능함
- HA를 위한 이중화나 클러스터링이 불가능
  - 고가용성, High Availability이란 서버와 네트워크, 프로그램 등의 정보 시스템이 상당히 오랜 기간 동안 지속적으로 정상 운영이 가능한 성질



#### 서빙

- **PromQL** 쿼리 언어를 이용해 조회가 가능함
- **외부 API**나 프로메테우스 웹콘솔을 이용해서 서빙이 가능
- 그라파나를 사용해 대쉬보드를 구성하는게 가능함





## 단점



#### 싱글 호스트 구조의 문제

- 데이터 백엔드와 저장소가 결합된 싱글 호스트 아키텍처이다
- HA 구성을 써드 파티앱을 통해 구성해야한다



#### 수집된 데이터는 정확하지 않음

- 풀링 주기를 기반으로 Metric을 수집하기에 수집된 데이터는 풀링하는 순간의 스냅샷이다
- 풀링이 수행되지 않는 시점에 메모리 사용률이 한번 튀었더라도 해당 상황을 잡아내지는 못함

