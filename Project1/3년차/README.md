# Project 1 / 3년차

- 5G 기반 협력 대응 과제
- KETI + Intelivix 개발내용 통합에 중점



## 일정

- 6월 : 
  - TCP/IP 서버 샘플 만들기(8일까지)
  - 보고 후 과제에 필요한 Message Broker 제작
  - 6월 내 CCTV+5G+PC -----> Edge Server 형태로 RTSP 영상 전송
- 7월 : 
  - GPS 및 블랙박스관련 개발



## Repository

#### tcp_ip_sample

- server - client 간 채팅 수준의 socket 통신



#### proto

- tcp/ip 서버를 중심으로 sender에서 client 로 message를 전송
- 문제발생 : 
  - tcp/ip 서버가 계속 열려있게 하기



#### multiple_client

- 다수의 클라이언트에서 1개의 서버로 메시지 전송
  - server : socket 서버
  - sender : edge server 로 메시지를 전달
  - device1,2,3 : msg 를 최종적으로 전달받을 device



#### EMDS 구성

- DB
  - Device
    - id
    - type
  - Edge
    - id
    - type
    - ip
- Device-Edge 연결제어



## reference

- [python sqlite3 참고 블로그](https://hleecaster.com/python-sqlite3/)
- [python socket 채팅 프로그램](https://seolin.tistory.com/98?category=762768)
- [VLC CLI 사용 예제](http://akshayc.com/blog/Stream-Audio-via-VLC/)



## 진행 단계(daily)

#### 0607

- 전체회의
  - 6월 : 
    - **TCP/IP 서버 샘플 만들기(8일까지)** - 기존에 했던 소켓통신
    - 보고 후 과제에 필요한 Message Broker 제작
    - 6월 내 CCTV+5G+PC -----> Edge Server 형태로 RTSP 영상 전송
  - 7월 : 
    - GPS 및 블랙박스관련 RTSP  영상 전송 개발



#### 0608

- TCP/IP 서버 샘플 완성 후 보고
  - 기본 샘플은 완성
  - ~~채팅 샘플 만들어보고 완성하면 보고하기~~ 완성



#### 0609

- 어제 회의 토대로 socket 통신 구성해보기 1단계
  - server 한개 - 클라이언트는 2종류 여러개가 메시지를 주고받게된다
  - multiple_client 폴더에서 진행중
    - json 으로 데이터를 주고받음
    - type 으로 device와 server 를 구분
    - 현재 server 와 device 로 구분되서 보내지고 있는거까지 확인
  - 앞으로 해야할 것 : 
    - device에 전달할 데이터 저장햇다가.. <mark>선입선출 가능해야함</mark>
      - DB사용?
      - 아니면 다른방법..? 
    - device 에서 요청이오면 데이터 전달하기



#### 0614

- 앞으로 해야할 것 : 
  - device에 전달할 데이터 저장햇다가.. <mark>선입선출 가능해야함</mark>
    - DB사용?
    - 아니면 다른방법..? 
  - device 에서 요청이오면 데이터 전달하기



#### 0615

- 선입선출 가능하게 DB연동 - SQLite3 사용중
- 아래 내용대로 일단 완성 후 차일 보고
  - ![image](https://user-images.githubusercontent.com/58541635/173778018-02f932f9-27df-44dd-ae73-e22dbc48085c.png)



#### 0616

- 오전, 논문 피드백
- ~~오후에 보고 드린 후 진행~~ 내일 오후 보고



#### 0620

- Message Broker 보고 완료
- 6월 내 CCTV+5G+PC -----> Edge Server 형태로 RTSP 영상 전송 기능 개발 시작
  - 일단 카메라와 PC 연동 진행중
  - 현재 사용중인 카메라 주소
    - **rtsp://keti:keti1234@192.168.0.46:88/videoMain**
  - 한 것
    - yang_ex 를 AP 에 연결해서 AP를 통해서 사용 가능하게끔 하기([무선 브릿지 - 무선 wifi 이용해서 공유기에 무선 wifi 가능하게 하기](https://favoritepps.tistory.com/49))
      - iptime 주소 : 192.168.0.78
      - 현재 iptime(2.4G) 에 카메라와 컴퓨터 연결 완료!



#### 0621

- 해야할 것
  - 서버1 : rtsp -> rtp(?) 로 서버2로 전송
  - 서버2 : 받은 rtp를 rtsp 로 다시 스트리밍
  - 두개가 완성되면 서버2에서 돌아가고있는 스트리밍 서버가 잘 돌아가고 스트리밍 할 수 있는지 확인



#### 0623

- 할 것
  - ~~카메라 작동 확인~~ 확인
  - 서버1 : rtsp -> rtp(?) 로 서버2로 전송
  - 서버2 : 받은 rtp를 rtsp 로 다시 스트리밍
- 완료 : 
  - 서버1 에서 동영상파일을 스트리밍 후 서버2 에서 재생 완료(같은 네트워크일때만 됨)
    - 주소 : rtp://239.0.0.1:5004 
    - 문제 : 
      - 스트리밍 끊김
      - 다른 네트워크일때 하는 방법 찾아야함!
- 문제점 : 
  - 서버1(공유기) - 서버2(핸드폰 테더링) 둘 사이간 접속이 안됨..
  - rtsp 를 받아와서 스트리밍서버로 만드는게 안됨



#### 0624

- 문제점 : 
  - ~~서버1(공유기) - 서버2(핸드폰 테더링) 둘 사이간 접속이 안됨.. // 네트워크 문제~~같은 공유기 내 ip 사용
  - ~~rtsp 를 받아와서 스트리밍서버로 만드는게 안됨 // ?~~ **트랜스코딩 활성화 안하고 하니까 됨**
- 완료 : 
  - 서버1 : rtsp -> rtp 로 서버2로 전송/스트림
    - 서버2의 url 로 unicast 전송
    - 주소 : rtp://192.168.0.50:5004 
  - 서버2 : 받은 rtp를 rtsp 로 다시 스트리밍
    - 서버1과 같이 rtsp 스트림서버로 
    - 주소 : rtsp://192.168.0.50:8554/videoMain



#### 0627

- 위 완료된 내용으로 Linux 환경에서 실행
  - 미니컴 2대, 카메라 1대 사용
  - ip는192.168.0.XX 사용할 것
  - 터미널 명령어로 vlc 실행해서 서버 구성



#### 0629

- 리눅스 환경에서 서버 구성
  - 미니컴 2대, 카메라 1대 사용
    - keti0 : 192.168.0.59 - rtsp 받아서 rtp 로 keti1에 전송
    - keti1 : 192.168.0.60 - rtp 받아서 rtsp 스트리밍하는 서버
    - 카메라 : rtsp://keti:keti1234@192.168.0.46:88/videoMain
  - ip는yang_ex, 192.168.0.XX 사용할 것
  - 터미널 명령어로 vlc 실행해서 서버 구성



#### 0630

- 위 서버구성과 vlc 설치 완료 후 카메라 작동 확인 완료
- 기존 윈도우 서버대로 커맨드 명령 환경에서 진행
  - 카메라 연결 완료
- 완료 :
  - keti0 : 192.168.0.59 - rtsp 받아서 keti1에 전송 - rtp://192.168.0.60:5004
  - keti1 : 192.168.0.60 - rtp 받아서 rtsp 스트리밍하는 서버 - **rtsp://192.168.0.60:8554/videoMain(최종 주소)**
  - 카메라 : rtsp://keti:keti1234@192.168.0.46:88/videoMain
- 문제 : 
  - 스트리밍 지속이 안됨..연결은 되어있는 상태



#### 0701

- vlc 앱으로는 구동 완료

- 커맨드라인에서 하는 방법 서칭하고 실행

- 커맨드 라인으로 실행

  - keti0 : 

    - 주소 : 192.168.0.59
    - 역할 : 카메라에서 rtsp 받아서 keti1에 rtp 전송하는 서버
    - 명령어 : `cvlc -vvv rtsp://keti:keti1234@192.168.0.46:88/videoMain --sout="#rtp{dst=192.168.0.60,port=5004,mux=ts}" --no-sout-all --sout-keep  `

  - keti1 : 

    - 주소 : 192.168.0.60
    - 역할 : rtp 받아서 rtsp 스트리밍하는 서버

    - `cvlc -vvv rtp://192.168.0.60:5004 --sout="#rtp{sdp=rtsp://:8554/videoMain}" --no-sout-all --sout-keep`



#### 0704

- 재전송 서버 지속이 얼마나 되는지 확인
- 카메라 세팅



#### 0705

- 카메라 오디오 제거하기
  - 제거 안됨
- 프레임 레이트 확인하기
  - 30으로 수정완료
- 초소형 PC 성능 좋은거 찾아보기
  - 천차만별...기본 100이상 [예시](https://www.usashop.co.kr/goods/goods_view.php?goodsNo=1000035135&inflow=naver&NaPm=ct%3Dl57mtiwg%7Cci%3D760498f05ee6e5f686bb3ab4b4313631dfbad647%7Ctr%3Dslsl%7Csn%3D1212958%7Chk%3De89be7be25eeaa0dcea6c83032891ec9722ab70e)
- 블랙박스 wifi  가능한것 찾아보기
  - 기본적으로 앱을 통해 영상 스트리밍 및 저장
  - [파인뷰](https://brand.naver.com/finevu/products/6022272258?NaPm=ct%3Dl57slkvc%7Cci%3Dc0b6646e785120697e5128b27f95aa0c93364f5a%7Ctr%3Dplac%7Csn%3D156008%7Chk%3Decd30e120cb48e84e4cf00bbb3ce59be06cf6e86)
  - [한라홀딩스 오토비](https://www.11st.co.kr/products/2707281985?NaPm=ct=l57srgag|ci=7af5b8d9ba760da645730cd287effca710adc51b|tr=slsbrc|sn=17703|hk=a5e86f68de63cb7011c5c230b32ab591a959ab0d&utm_term=&utm_campaign=%B3%D7%C0%CC%B9%F6pc_%B0%A1%B0%DD%BA%F1%B1%B3%B1%E2%BA%BB&utm_source=%B3%D7%C0%CC%B9%F6_PC_PCS&utm_medium=%B0%A1%B0%DD%BA%F1%B1%B3)



#### 0707

- 회의 내용
  - 앞으로 진행할 내용 : 
    - 완성한 Device(CCTV-Server) --- TCP/IP Server --- Edge Server --- EDMS 통합하기
    - EDMS 부분 구성하기
      - DB 추가
      - Device 등록
      - Edge 등록
      - Device-Edge 간 연결제어
    - 결과물 : EDMS에서 명령을통해 Edge에서 RTSP Server 가 구성되고 재생되어야함
- 확인한 내용 : 
  - Edge 에서 rtsp 서버가 구성되기 전 실행시키고 무한 루프를 돌려놓는건 불가능



#### 0708

- 진행중 :
  - 하드웨어 설정 : 
    - 메인 pc : EDMS (TCP/IP 서버 보유)
    - keti0 : CCTV와 연결되어있는 서버
    - keti1 : Edge 서버 역할로 최종 RTSP 서버
  - EDMS 부분 구성하기
    - **DB 추가** (완료)
    - **Device 등록** 
    - **Edge 등록** 
    - Device-Edge 간 연결제어
- 진행해야할 것 : 
  - Device 및 Edge 등록 간단하게 구현되어있는거 추후 수정해야함
  - ~~socket 통신이 다른 ip로 전달이 안되는데 해결해야함~~ 해결은됨



#### 0714

- socket 통신 되니까 이제 연결제어부분 시작
- 진행중 : 
  - `tcp_server.py` : edms / socket 통신으로 메시지(ip 등)을 전달하고 DB와 연동
  - `msg_send.py` : edms / edms에서 msg를 보내는 역할
  - `device1.py` : cctv-device / cctv와 연결되어있는 server로 d_id 를 갖고있고 해당 정보로 cctv의 rtsp주소와 edge server의 ip 를 응답받는다
- 문제 : 
  - 내부망으로 바껴서 IP, 네트워크 변화 있음
    - 동시에 외부망(wifi) 사용해서 해결
  - ~~`tcp_server.py` 에서 mid 변수가 int 가 아닌 str 로 인식이됨..(기존서버에서는 잘됨)~~



#### 0715

- ~~14일 문제에서 mid 변수 해결 후 진행~~ ip 보낼때 send.py 에서 fetchone()[0] 해줘서 해결
- device.py에 rtp 전송 명령어 잘 실행되는지 확인해야함
- 문제 : 
  - keti1 (rtp 받아서 rtsp로 재전송하는 서버)에서 rtp -> rtsp 재전송하려면 이벤트발생 트리거가 필요함..



#### 0718

- 문제 : 
  - keti1 (rtp 받아서 rtsp로 재전송하는 서버)에서 rtp -> rtsp 재전송하려면 이벤트발생 트리거가 필요함..
    - /tcp_ip/edge.py 만들어서 해볼까하는데 더 생각해야됨
      - device.py 에서 cvlc 명령이 실행된 뒤에 edge.py 에서 실행되어야함!!
    - 어떻게 해결할지 고민해보기 + 보고드리기
- 진행중 : 
  - edge 와 tcp server 간 통신
  - device.py 에 cvlc 명령 부분에서 rtsp주소와 edge server주소를 변수로 입력하게끔 변경해야함



#### 0719

- cvlc 명령부분 %s 로 해결
- edge와 tcp 서버간 통신 완료
- 문제점 : 
  - 지금은 같은 공유기 및 wifi 로 실행하는데, 나중에는 edms 서버 및 edge는 다른 주소의 인터넷을 쓸텐데 통신이 가능한지?
- 진행해야 할 것 : (목요일까지 말씀드리기)
  - 5G 모뎀 찾아보기
  - 위치정보 전달, 와이파이로 영상 끌어올수있는 블랙박스



#### 0720

- 5G 모뎀
  - LG CNR-5G100
    - 링크 : http://www.lguplusme.co.kr/page/s2_28
    - 200G/99,000원
    - 2.4GHz/5GHz 두가지 Wifi 제공
  - KT 5G egg
    - 링크 : https://shop.kt.com/unify/mobile.do?prodNo=WL00057791&pplId=0813
- 블랙박스
  - GPS 위치정보 :
    - 블랙박스 구매시 GPS모듈을 구매가능
    - 그에 따른 위치정보 데이터를 활용하는 방법은?
  - wifi 로 영상 데이터 : 
    - wifi 동글 함께 구매 필요
    - 모든 제품들이 해당 회사의 앱, 뷰어 등을 설치 후 다운로드
  - 제품링크 : 
    - 파인뷰 :
      - 링크 : https://brand.naver.com/finevu/products/6022272258
      - 5GHz 속도로 업데이트 및 영상 다운로드
    - 오토비 : 
      - 링크 : http://www.11st.co.kr/products/2707281985/share
    - 드림아이 : 
      - 링크 : https://smartstore.naver.com/gnetsystem/products/6817571059
    - Type S(미국)
      - 링크 : https://typesauto.com/products/type-s-drive-360-dash-cam-live-stream-bt530211
      - 자체 앱 사용으로 유튜브, facebook 에 스트리밍 가능
    - Black vue(미국)
      - 링크 : https://shop.blackvue.com/product/dr750x-2ch-dms-lte-plus/
      - 자체 Cloud 앱에 저장 가능
- 논문
  - 웹서비스 기반 자동차 블랙박스 온라인 사고기록 확인 시스템 개발
    - 링크 : https://koreascience.kr/article/CFKO201423965829244.pdf
  - 모바일 클라우드를 이용한 차량용 블랙박스 영상 통합관리 시스템
    - 링크 : https://koreascience.kr/article/JAKO201333651337175.pdf
  - 차량용 블랙박스를 활용한 교통위반신고 자동화 방법
    - 링크 : https://koreascience.kr/article/JAKO201433552234030.pdf



#### 0721

- 5G 모뎀 및 블랙박스 보고드리기



#### 0725

- 모뎀 블랙박스 더 리서치해보기
- 내일부터 포트폴리오 준비 및 깃허브 좋은 예시 찾아서 차근차근 정리하기



#### 0726

- 블랙박스 리서치
- 모뎀 리서치



#### 0727

- 리서치 계속 진행 후 정리해서 자료로 남기기
- 블랙박스
  - GPI / 차량용 IP 카메라 
    - http://www.gpikorea.com/kr/bbs/board.php?bo_table=pro03_kr&wr_id=2
    - RTSP, OnVIF, POE 지원



#### 0801

- 블랙박스 
  - GPI Korea / 차량용 IP 카메라 
    - http://www.gpikorea.com/kr/bbs/board.php?bo_table=pro03_kr&wr_id=2
    - RTSP, OnVIF, POE 지원
  - 아이디스 / 소형 IP 카메라+모듈
    - http://item.gmarket.co.kr/DetailView/Item.asp?goodscode=2367214347&GoodsSale=Y&jaehuid=200001169&NaPm=ct%3Dl6a6rkog%7Cci%3Dc6282270f259f864f715e5da14a668449750fd95%7Ctr%3Dslsl%7Csn%3D24%7Chk%3Da5e1d6bf3c817f90e17154e21837e75a8bb8eb5e
    - RTSP, OnVIF, POE 지원
- GPS 
  - GPS 수신기 리서치
  - GPS 수신기 활용하여 좌표를 사용할 수 있어야함



#### 0802

- GPS 
  - 아두이노 NEO-6M
- GPS 대체 코드
  - Geoplugin 사용해서 IP 로케이션 찾는 방법 : 
    - 해당 ip 를 가지고 위치를 찾는 방식
    - gps 폴더 내 `geo.py`
    - 집에 가면서 위치 이동될때마다 해보기
  - ~~카카오 API 사용~~ 주소 필요해서 사용 안함
    - 키 : 2e9a9ab884c6c5fbc7d5e13bb9b4818b



#### 0803

- GPS 리서치
  - [라즈베리파이를 이용한 차량 추적 시스템 연구](http://journal.dcs.or.kr/xml/24195/24195.pdf)
    - 라즈베리 파이와 인터넷에 연결되는 스마트폰, 인터넷에 연결된 서버가 필요
    - 라즈베리 파이는 스마트폰의 핫 스폿을 통하여 서버에 접속하여 수 배 차량에 대한 정보를 받고
    - 카메라와 GPS 정보를 핫 스폿을 통하여 서버에게 전송하는 구조



#### 0804

- GPS 및 블랙박스 리서치
  - 블랙박스(소형 RTSP 카메라)
    - 아이디스 NC-V4211XJ
      - 설명 링크 : https://www.idisglobal.com/index/product_view/3058
      - 구매 링크 : http://auction.kr/iCdf_gm
    - GPI Korea / 차량용 IP 카메라 
      - http://www.gpikorea.com/kr/bbs/board.php?bo_table=pro03_kr&wr_id=2
      - 카메라에 무선라우터와 유선연결 필요
      - 구매 시 업체 연락 필요(구매 사이트 없음) : 29만원/50대 미만
  - GPS
    - 라즈베리파이 GPS 모듈 EZ-0048
      - 구매 링크 : https://smartstore.naver.com/mcuboard/products/5665912954
      - 사용법 : https://wiki.52pi.com/index.php?title=EZ-0048
      - GPS와 기존 서버를 바로 연결해서 사용 가능할듯함



#### 0808

- 특허 아이디어
- 차량용 IP 전방 카메라
  - 모델명 : GPCF-673A1GN
  - 업체명 : GPI Korea
  - 설명 링크 : http://www.gpikorea.com/kr/bbs/board.php?bo_table=pro03_kr&wr_id=2
  - 구매 연락처 : sales@gpi360.com
- GPS 모듈
  - 모델명 : NT114990732
  - 업체명 : Seeed
  - 컴퓨존 구매 링크 : http://www.compuzone.co.kr/product/product_detail.htm?ProductNo=462441&banner_check=naver&NaPm=ct%3Dl6kd5vrc%7Cci%3Dfd093879167a6893fee390d5f954430d0b4bf456%7Ctr%3Dsls%7Csn%3D116863%7Chk%3D8239548a655fb62b1811706391ec2596c77cc22a
- 앞으로 일정
  - 카메라, GPS 구매 되는데로 개발 착수
    - ~~GPS 따로 한개 구매 후 책임님께 구매보고~~
  - 기존 했던 CCTV 끊김 현상 step by step 으로 어느 부분에서 끊기는지 확인 및 문제점 찾기
    - 유선으로도 연결해보기



#### 0809

- 기존 했던 CCTV 끊김 현상 step by step 으로 어느 부분에서 끊기는지 확인 및 문제점 찾기
- GPS 도착하면 GPS 데이터 사용법 및 전송하는 테스트
- 인텔리빅스에 CCTV 스트리밍 전달해야하는데 확실하게 되는지 알아보기
  - 포트포워딩?
- POSCAM 카메라 테스트
  - 카메라-PC 무선 연결 :
    1. 그래픽 카드O, 고사양 PC : 끊김 거의 없음
    2. 미니 PC : 끊김현상 심함
  - 카메라-미니PC 유선 연결 : 
    - 스트리밍 주소 자동으로 변경됨 : rtsp://keti:keti1234@192.168.0.73:88/videoMain
    - 미니 PC로만 진행했는데 **끊김현상 없음**
  - 카메라-미니PC 유선연결 후 무선 rtp 재전송 :
    - 미니PC 2에서 rtp 주소 : rtp://192.168.0.60:5004
    - 결과 : **끊김현상 심함**
  - 카메라-미니PC 유선연결 후 미니PC 2로  무선 rtp 재전송 :
    - 미니PC 2에서 rtp 주소 : rtp://192.168.0.75:8080
    - 결과 : **끊김현상 심함**
  - 카메라-미니PC 유선연결 후 미니PC 2로 유선 rtp 재전송 :
    - 미니PC 2에서 rtp 주소 : rtp://192.168.0.75:8080
    - 결과 : **끊김현상 없음**
- AXIS 돔형 카메라 테스트
  - 카메라-PC 유선연결
  - 유선 연결 후 rtp 전송
    - cvlc -vvv rtsp://root:keti@169.254.147.5/onvif-media/media.amp?profile=profile_1_h264&sessiontimeout=60&streamtype=unicast --sout="#rtp{dst=192.168.0.60,port=5004,mux=ts}" --no-sout-all --sout-keep
    - **위 주소로 rtp전송, 미니 pc에서 rtsp 직접 스트리밍 모두 안됨...왜?**
- AXIS 카메라 테스트
  - 카메라-PC 유선연결



#### 0810

- AXIS 돔형 카메라 테스트
  - 카메라-PC 유선연결
    - 윈도우 pc에서는 연결 완료
  - 유선 연결 후 rtp 전송
    - cvlc -vvv rtsp://root:keti@169.254.147.5/onvif-media/media.amp?profile=profile_1_h264&sessiontimeout=60&streamtype=unicast --sout="#rtp{dst=192.168.0.60,port=5004,mux=ts}" --no-sout-all --sout-keep
    - **위 주소로 rtp전송, 미니 pc에서 rtsp 직접 스트리밍 모두 안됨...왜?**
      - 192.168.0.94 주소 사용법 알아보기
- GPS 모듈 변경
  - 변경 할 모듈 찾고
  - 주문 취소 요청 드려야함!
  - **일단 현재 제품으로 우분투 사용가능하다고 하여 진행중인데 데이터 완벽하게 안받아짐**



#### 0811

- GPS 모듈 데이터 받기 (EZ-0048)
  - terminal 에서 안되면 일단 python 코드로 가능한지 해보기!!
    - python 도 gpsd 데이터를 사용하는데 데이터가 온전하지 않음..
  - 참고 사이트
    - 제품 정보(한글) : https://fishpoint.tistory.com/6484
    - wiki 및 튜토리얼 : https://wiki.52pi.com/index.php?title=EZ-0048
    - 기타 튜토리얼 : https://www.dfrobot.com/blog-772.html
- AXIS 돔형 카메라 진행하기
  - (유선) 내 자리에 있는 카메라 주소 : 
    - 
  - (무선) 실험실에 있는 카메라 주소 : 
    - rtsp://192.168.0.93/onvif-media/media.amp?profile=profile_1_h264&sessiontimeout=60&streamtype=unicast



#### 0816

- AXIS 돔형 카메라
  - 유선연결 : 
    - 카메라 주소 :  rtsp://root:keti@192.168.0.94/onvif-media/media.amp?profile=profile_1_h264&sessiontimeout=60&streamtype=unicast
    - 상태 : 
      - 미니PC1 에 연결
      - 3) 느림
  - 무선연결(iptime 사용) : 
    - 카메라 주소 :  rtsp://root:keti@192.168.0.94/onvif-media/media.amp?profile=profile_1_h264&sessiontimeout=60&streamtype=unicast
    - 상태 : 
      - 메인 PC에 연결
      - 1) http 연결 시 제일 딜레이가 적고
      - 2) onvif 시 조금 느림
      - 4) vlc 로 재생하는게 제일 느림
- **AXIS 카메라**
  - 주소 : rtsp://root:ketiabcs@192.168.0.120/axis-media/media.amp
  - 무선 테스트 : 
    - PC1 -> PC2 rtp 전송 : 가까이 사물있으면 끊김, 움직이는 사물이 멀리 있으면 덜 끊김
    - 메인PC -> PC2 rtp 전송 :  끊김 훨씬 덜함
- 진행 상황 : 
  - 무선과 유선으로 연결해서 스트리밍 상태 확인 완료
  - 유선 연결한 PC1 에서 PC2 로 재전송 해보기
  - 보고 완료 후 오후에 양책임님 컴퓨터에 셋업해서 확인 필요
- **GPS 데이터 받아오기**
  - 참고 사이트
    - 제품 정보(한글) : https://fishpoint.tistory.com/6484
    - wiki 및 튜토리얼 : https://wiki.52pi.com/index.php?title=EZ-0048
    - 기타 튜토리얼 : https://www.dfrobot.com/blog-772.html
  - gps 계속 no fix 오류나는데 가져가서 테스트해보기



#### 0817

- GPS 데이터 사용하기

  - 야외(옥상)에서 Mac OS 로 했더니 정보 잘 받아옴

    ```
    $GPRMC,071340.000,A,3734.8516,N,12653.2972,E,0.14,55.26,170822,,,A*54
    $GPVTG,55.26,T,,M,0.14,N,0.26,K,A*08
    $GPGGA,071341.000,3734.8517,N,12653.2973,E,1,8,0.99,79.5,M,19.2,M,,*61
    $GPGLL,3734.8517,N,12653.2973,E,071341.000,A,A*5D
    $GPGSA,A,3,15,24,13,23,30,05,20,18,,,,,1.28,0.99,0.81*0C
    $GPGSV,3,1,10,15,73,312,21,13,57,039,28,05,55,086,42,18,50,300,39*71
    $GPGSV,3,2,10,24,33,188,34,20,22,111,39,23,19,302,37,29,14,232,*71
    $GPGSV,3,3,10,30,12,040,29,193,,,*7C
    $GPRMC,071341.000,A,3734.8517,N,12653.2973,E,0.13,20.24,170822,,,A*52
    $GPVTG,20.24,T,,M,0.13,N,0.24,K,A*0D
    $GPGGA,071342.000,3734.8518,N,12653.2972,E,1,8,0.99,79.5,M,19.2,M,,*6C
    $GPGLL,3734.8518,N,12653.2972,E,071342.000,A,A*50
    $GPGSA,A,3,15,24,13,23,30,05,20,18,,,,,1.28,0.99,0.81*0C
    $GPGSV,3,1,10,15,73,312,20,13,57,039,27,05,55,086,42,18,50,300,39*7F
    $GPGSV,3,2,10,24,34,188,34,20,22,111,39,23,19,302,37,29,14,232,*76
    $GPGSV,3,3,10,30,12,040,29,193,,,*7C
    $GPRMC,071342.000,A,3734.8518,N,12653.2972,E,0.05,9.37,170822,,,A*61
    $GPVTG,9.37,T,,M,0.05,N,0.10,K,A*34
    $GPGGA,071343.000,3734.8518,N,12653.2972,E,1,8,1.00,79.4,M,19.2,M,,*6D
    $GPGLL,3734.8518,N,12653.2972,E,071343.000,A,A*51
    $GPGSA,A,3,15,24,13,23,30,05,20,18,,,,,1.71,1.00,1.38*02
    $GPGSV,3,1,10,15,73,312,20,13,57,039,34,05,55,086,42,18,50,300,39*7D
    $GPGSV,3,2,10,24,34,188,33,20,22,111,39,23,19,302,37,29,14,232,*71
    $GPGSV,3,3,10,30,12,040,29,193,,,*7C
    $GPRMC,071343.000,A,3734.8518,N,12653.2972,E,0.00,46.79,170822,,,A*54
    $GPVTG,46.79,T,,M,0.00,N,0.01,K,A*00
    $GPGGA,071344.000,3734.8519,N,12653.2972,E,1,8,0.99,79.5,M,19.2,M,,*6B
    $GPGLL,3734.8519,N,12653.2972,E,071344.000,A,A*57
    $GPGSA,A,3,15,24,13,23,30,05,20,18,,,,,1.28,0.99,0.81*0C
    $GPGSV,3,1,10,15,73,312,21,13,57,03%
    ```



#### 0818

- 위 GPS 데이터 사용해 python 프로그램 만들기
  - /3년차/gps/gps_data.py 
    - 정확한 전자회관 위치 정보 : 37.580900 N, 126.888402 E
    - GPS가 전달받은 정보 : 37.348517 N, 126.532973 E
    - 방법 : 
      - pyserial, pynmea2 모듈 사용
        - pyserial : serial 데이터를 받아옴
        - pynmea2 : 받아온 gps GPGGA 데이터를 Parsing 해서 사용가능
    - **parseGPS() 에 if 문에 안들어감 문제 해결해야함**
- 프로젝트 총 네트워크 상황
  - 카메라-PC
    - 유선
  - Edge Server
    - 외부망 설정(수동으로 설정 해줘야함) - 엣지 서버
      - IP : 123.214.186.162
      - Sub : 255.255.255.128
      - GW : 123.214.186.129
      - DNS : 128.126.63.1 / 210.220.163.82 / 210.94.0.73 / 210.20.163.82



#### 0819

- CCTV 거치대 찾아보기

- 미니 PC 찾아보기

  - [Minix Technology Limited] NEO N42C-4 Plus N4100([링크](http://www.compuzone.co.kr/product/product_detail.htm?ProductNo=809496&BigDivNo=&MediumDivNo=1005&DivNo=))

    - 사이즈 : 139 * 139 * 35 mm
    - 가격 : 305,000원

  - [GIGABYTE] BRIX GB-BMCE-4500C([링크](http://www.compuzone.co.kr/product/product_detail.htm?ProductNo=856164&BigDivNo=&MediumDivNo=1005&DivNo=))

    - 사이즈 : 116.52 * 103 * 56.22 mm

    - 가격 : 198,000원

  - [ECS] LIVA Q1L N4200([링크](http://www.compuzone.co.kr/product/product_detail.htm?ProductNo=878676&BigDivNo=&MediumDivNo=1005&DivNo=))

    - 사이즈 : 74 * 74 * 34.6 mm
    - 가격 : 279,000원

  - Mele 미니 PC(구매대행)

    - 사이즈 : 131 * 81 * 18.3 mm
    - 가격 : 351,700원
    - 링크 : https://smartstore.naver.com/alishop/products/6286680846



#### 0822

- 도시락
  - https://docs.google.com/forms/d/e/1FAIpQLSfqooy9va0_Iq3CuInAI04sY6Pt__dBqNsUSpaT8sfb5nDc_g/viewform
- oneM2M 교육 참석
  - 일시 : **8월 22일(월) 08시 50분 ~17시 (1일 전일 교육, 중식 제공)**
  - 장소 : **한국과학기술회관 2관 지하1층 중회의실 5**
          (2호선 강남역 12번 출구, 국기원사거리)
  - 주제 : oneM2M 개발, 연동기술 세미나



#### 0823

- 5G 모뎀 사용 가능
  - 설계 : 
    - 미니컴퓨터(뒷자리)를 5G모뎀 유선 연결된 PoE에 연결
    - 카메라(PoE 카메라 아님) 유선연결
    - 엣지서버(실험실)로 rtp 전송
- **구성도**
  - Foscam 카메라
    -  IP : rtsp://root:keti1234@192.168.225.30:88/videoMain 
    - 미니PC와 유선연결
  - 미니PC : 
    - 5G
    - IP : 192.168.225.27
    - 5G라우터를 통해 Edge Server 로 rtp 전송
      - rtp://123.214.186.162:5004
  - Edge Server
    - 유선 외부망
    - IP : 123.214.186.162
    - 유선 외부망을 통해 rtsp 스트리밍
      - rtsp://123.214.186.162:8554/cctv1
- GPS 진행
  - 미니PC(차량용 서버)에서 Edge Server 로 gps 정보 ~~1초마다 전송~~ 생성될 때 마다 전송
  - Edge Server 에서 gps 데이터를 보관해야함
  - GPS 정보 : 
    - 연결된 차량 or cctv ID ---> 서버의 username 으로 대체
    - UTC 시간
    - GPS 정보



#### 0824

- GPS 데이터 client-server (소켓 사용)
  - gps_client.py
    - 현재 데이터는 모두 생성하고 사용가능
    - 데이터 json 형태로 담아서 보냄
  - gps_server.py
    - ~~기본적 서버부터 구성부터 해야함~~  소켓서버로 구성
    - server 에 데이터 json 으로 전달 받으면 저장하는거부터 하면됨



#### 0825

- GPS server 에서 데이터 받기까지는 완료, 저장하는거 하면됨



#### 0826

- 인텔리빅스에서 사용 가능한 rtsp 주소 및 gps rest api

  - 카메라 주소 : rtsp://123.214.186.162:8554/videoMain

  - gps 요청 : http://123.214.186.162:8088/get_gps?did=keti0

    

- GPS

  - 소켓 사용하다가 지금 다시 REST API 형식으로 바꿈(rest 폴더에서 진행)
    - gps_server.py : Edge 에서 동작하는 서버
    - gps_client.py : cctv, 5G 모듈이 연결된 pc 에서 동작하는 client



#### 0830

- 회의 토대로 스트리밍 및 GPS 내용 수정, 보완
  - RTSP
    - 이번주 내로 거치대 오면 실험실에 카메라세팅 with 움직이는 화면
    - 박스형 카메라 제작(9월중순)
      - 5G모듈, 미니 PC 필요
  - GPS
    - 기존 방식대로 REST API 로 전송
    - 해야할 것
      - (수) : 실시간 이동되는 정보를 DB에 저장
      - (목) : 노트북에 리눅스 환경 설치 후 실제로 차량 운행 할 수 있게끔 세팅
  - 다음주 쯤 인텔리빅스 방문 할수도 있음
  - **특허 다음주까지 아이디어 2개 이상 생각해보기**



#### 0831

- GPS 실시간 이동되는 정보 DB에 저장할 수 있게끔
  - Server DB 에 {gps_id}_save 테이블로 GPS 데이터 저장중
  - 노트북 인계받아 우분투 설치 후 환경 설정
    - Ubuntu 20.04 LTS
    - 환경 및 코드 수정 완료



#### 0901

- 데이터 안들어오면 안보내게끔 수정 - 완료
- 데이터 client 터미널에 프린트 되게끔 수정 - 완료
- ttyUSB0에서 숫자가 변경될수 있는데 변경되도 사용가능하게끔 - 완료
- 데이터 오차 수정하는 작업 필요함
  - 전자회관 GPS 데이터 - 오차 내용 : 
    - 안드로이드폰 GPS
      - lat : 37.581156
      - lon : 126.888466
    - GPS 모듈
      - lat : 37.348578
      - lon : 126.532997
    - **오차 : **
      - lat : 0.232578
      - lon : ~~0.355469~~ 0.353769
  - 오차 활용하여 맵에 표시해보기
    - 오차가 있지만 일단 사용하기로함



#### 0902

- 어제 저장된 GPS 정보 1초마다 Edge Server 로 전송하는 코드짜기 - 완료

- CCTV, 5G모듈, PC 를 모두 실험실에 세팅 - rtsp 영상 확인 완료

- **완성 내용**

  - 화요일부터 인텔리빅스에서 사용

    - 영상 전송

      - 주소 : rtsp://123.214.186.162:8554/videoMain
      - 서버 운영 : 
        - 미니pc : 
          - `cvlc -vvv rtsp://root:keti1234@192.168.225.30:88/videoMain --sout="#rtp{dst=123.214.186.162,port=5004,mux=ts}" --no-sout-all --sout-keep  `
        - Edge server :
          - `cvlc -vvv rtp://123.214.186.162:5004 --sout="#rtp{sdp=rtsp://:8554/videoMain}" --no-sout-all --sout-keep`

    - gps 데이터

      - 주소 : http://123.214.186.162:8088/get_gps

      - 데이터 response 예시 : 

        - ```
          {
              "alt": "24.7",
              "alt_units": "M",
              "dt": "09/01/2022, 05:44:04",
              "gps": {
                  "lat": "37.598308",
                  "lat_dir": "N",
                  "lon": "126.841352",
                  "lon_dir": "E"
              },
              "gps_id": "keti0"
          }
          ```

      - 서버 운영 : 

        - 미니pc :
          - `python3 gps_temp_transer.py`
        - Edge server : 
          - `python3 gps_server.py`



#### 0906

- 특허 아이디어
  - 통합 관제형 재난경보 CCTV
    - 아이디어 시작점 : 
      - 올해 초대형 태풍 '힌 남노'에 대한 우려가 높았음
      - 재난 방송국 KBS의 마라도 CCTV가 관심을 받으며 직접 시청자들이 찾아서 보는 등 의 현상 
        - ""마라도 CCTV 볼 수 있다"…힌남노 정보 찾아 '네·카'에 몰린다" https://www.hankyung.com/it/article/202209052376g
      - 
    - 기존 재난 CCTV : 
      - ![image](https://user-images.githubusercontent.com/58541635/188538999-b8693158-859e-45f8-99de-3813b9ea43ef.png)
      - 눈으로 보이는 파도의 세기, 구름 등은 확인 할 수 있지만 자세하고 수치 정보들은 알 수 없음
      - CCTV의 흔들림 정도로 대략적인 바람, 태풍의 세기를 짐작 가능함
    - 발명 CCTV : 
      - 풍량, 풍속, 강우량, 흔들림 등 을 측정할 수 있는 센서를 해당 CCTV와 결합
      - 더 정확하고 다양한 정보를 관제센터에 전달하여 가시적이고 직관적이게 설계 가능
      - 해당 영상데이터 및 센서데이터를 저장, 관리, 표출
      - 추후에 발생하는 태풍과 비교분석 및 예상, 경고 가능



#### 0907

- 특허관련 진행하기
  - 아이디어1. 위험도, 환경 학습 기반 PTZ 카메라 제어 (**좀 더 구체적이게 발전시키기**)
    - 위험도 학습이 가능한 엣지가 장착된 PTZ 카메라
    - 위험도 학습 - 유동인구따라 구역마다 위험도 설정
    - 환경  학습 - 시정, 장애물에 따라
  - 아이디어2. 무인점포 기반한 아이디어 (**아이디어 도출부터 해야함**)+모빌리티 카메라?
  - 아이디어3. 모빌리티, 엣지 기반 아이디어
  - 아이디어4. 센서 사용가능한 cctv
- 차량용 카메라 도착
  - IP 수정
    - 기존 : 192.168.0.100
    - 변경 : 192.168.225.40



#### 0908

- 차량용 카메라 rtp 전송 끊김현상 해결

  - 원래 미니pc -5G 모뎀으로 Edge 서버에 전송시 끊김
  - 다른 컴퓨터에서 다른 네트워크로 rtp 전송해보니 끊김현상 줄어듬
  - 카메라 설정 낮춤
    - bitrate : 7000 to **2000**
    - 화질 : 1920 to **1280**

- GPS 데이터 확인

  - 데이터는 거의 동일, 여전히 서해쪽 표시됨

  ```
  <기존 GPS>
  $GPGGA,034010.000,3734.8743,N,12653.2955,E,1,8,1.16,47.2,M,19.2,M,,6C
  $GPGGA,034024.000,3734.8728,N,12653.2959,E,1,8,1.16,47.1,M,19.2,M,,69
  $GPGGA,034025.000,3734.8727,N,12653.2960,E,1,8,1.16,47.1,M,19.2,M,,6D
  $GPGGA,034026.000,3734.8727,N,12653.2960,E,1,8,1.16,47.1,M,19.2,M,,6E
  $GPGGA,034027.000,3734.8726,N,12653.2961,E,1,8,1.16,47.1,M,19.2,M,,6F
  $GPGGA,034028.000,3734.8725,N,12653.2962,E,1,8,1.16,47.1,M,19.2,M,,60
  $GPGGA,034029.000,3734.8725,N,12653.2963,E,1,8,1.16,47.1,M,19.2,M,,60
  $GPGGA,034030.000,3734.8725,N,12653.2965,E,1,8,1.16,47.1,M,19.2,M,,6E
  
  <GPS 1>
  $GPGGA,030339.000,3734.8657,N,12653.3050,E,1,7,1.17,68.9,M,19.2,M,,*61
  $GPGGA,030341.000,3734.8655,N,12653.3050,E,1,7,1.17,69.0,M,19.2,M,,*64
  $GPGGA,030358.000,3734.8649,N,12653.3048,E,1,7,1.17,69.1,M,19.2,M,,*69
  $GPGGA,030350.000,3734.8651,N,12653.3047,E,1,7,1.17,69.1,M,19.2,M,,*67
  $GPGGA,030357.000,3734.8649,N,12653.3048,E,1,7,1.17,69.1,M,19.2,M,,*66
  $GPGGA,030359.000,3734.8649,N,12653.3048,E,1,7,1.17,69.1,M,19.2,M,,*68
  $GPGGA,030356.000,3734.8649,N,12653.3047,E,1,7,1.17,69.1,M,19.2,M,,*68
  $GPGGA,030339.000,3734.8657,N,12653.3050,E,1,7,1.17,68.9,M,19.2,M,,*61
  $GPGGA,030341.000,3734.8655,N,12653.3050,E,1,7,1.17,69.0,M,19.2,M,,*64
  $GPGGA,030400.000,3734.8649,N,12653.3049,E,1,7,1.17,69.1,M,19.2,M,,*62
  
  <GPS 2>
  $GPGGA,030634.000,3734.8548,N,12653.3005,E,1,6,1.57,70.8,M,19.2,M,,*69
  $GPGGA,030636.000,3734.8544,N,12653.2999,E,1,6,1.47,75.0,M,19.2,M,,*66
  $GPGGA,030639.000,3734.8533,N,12653.2970,E,1,6,1.47,91.4,M,19.2,M,,*60
  $GPGGA,030633.000,3734.8526,N,12653.2987,E,1,6,1.47,72.5,M,19.2,M,,*6A
  $GPGGA,030637.000,3734.8516,N,12653.2978,E,1,6,1.47,78.0,M,19.2,M,,*62
  $GPGGA,030635.000,3734.8554,N,12653.3016,E,1,6,1.47,70.8,M,19.2,M,,*66
  $GPGGA,030641.000,3734.8527,N,12653.2952,E,1,6,1.47,86.3,M,19.2,M,,*6B
  $GPGGA,030632.000,3734.8524,N,12653.2989,E,1,6,1.47,70.9,M,19.2,M,,*69
  $GPGGA,030638.000,3734.8541,N,12653.2981,E,1,6,1.47,82.0,M,19.2,M,,*6C
  $GPGGA,030642.000,3734.8532,N,12653.2955,E,1,6,1.47,84.3,M,19.2,M,,*69
  $GPGGA,030649.000,3734.8503,N,12653.2942,E,1,6,1.47,89.6,M,19.2,M,,*6E
  
  <GPS 3>
  $GPGGA,031051.000,3734.8614,N,12653.3041,E,1,6,1.48,76.8,M,19.2,M,,*6F
  $GPGGA,031053.000,3734.8601,N,12653.3042,E,1,6,1.48,80.3,M,19.2,M,,*68
  $GPGGA,031056.000,3734.8557,N,12653.2989,E,1,7,1.35,93.9,M,19.2,M,,*61
  $GPGGA,031050.000,3734.8607,N,12653.3035,E,1,6,1.52,77.1,M,19.2,M,,*6C
  $GPGGA,031057.000,3734.8558,N,12653.2988,E,1,7,1.35,93.4,M,19.2,M,,*63
  $GPGGA,031036.000,3734.8598,N,12653.3025,E,1,5,1.66,72.9,M,19.2,M,,*61
  $GPGGA,031054.000,3734.8572,N,12653.3029,E,1,6,1.48,83.2,M,19.2,M,,*67
  $GPGGA,031052.000,3734.8597,N,12653.3040,E,1,6,1.48,82.9,M,19.2,M,,*6F
  $GPGGA,031058.000,3734.8560,N,12653.2987,E,1,7,1.35,92.8,M,19.2,M,,*65
  $GPGGA,031049.000,3734.8606,N,12653.3066,E,1,5,1.66,57.6,M,19.2,M,,*62
  $GPGGA,031055.000,3734.8556,N,12653.3025,E,1,6,1.52,85.2,M,19.2,M,,*61
  $GPGGA,031059.000,3734.8562,N,12653.2987,E,1,7,1.35,91.8,M,19.2,M,,*65
  $GPGGA,031051.000,3734.8614,N,12653.3041,E,1,6,1.48,76.8,M,19.2,M,,*6F
  $GPGGA,031106.000,3734.8562,N,12653.2986,E,1,8,1.05,91.8,M,19.2,M,,*63
  
  <GPS 4>
  $GPGGA,031258.000,3734.8583,N,12653.3041,E,1,8,1.04,79.1,M,19.2,M,,*69
  $GPGGA,031311.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*67
  $GPGGA,031258.000,3734.8583,N,12653.3041,E,1,8,1.04,79.1,M,19.2,M,,*69
  $GPGGA,031311.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*67
  $GPGGA,031312.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*64
  $GPGGA,031258.000,3734.8583,N,12653.3041,E,1,8,1.04,79.1,M,19.2,M,,*69
  $GPGGA,031313.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*65
  $GPGGA,031311.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*67
  $GPGGA,031312.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*64
  $GPGGA,031314.000,3734.8585,N,12653.3044,E,1,9,1.03,77.7,M,19.2,M,,*6D
  $GPGGA,031258.000,3734.8583,N,12653.3041,E,1,8,1.04,79.1,M,19.2,M,,*69
  $GPGGA,031313.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*65
  $GPGGA,031315.000,3734.8585,N,12653.3044,E,1,9,1.03,77.7,M,19.2,M,,*6C
  $GPGGA,031311.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*67
  $GPGGA,031312.000,3734.8585,N,12653.3044,E,1,9,1.03,77.8,M,19.2,M,,*64
  $GPGGA,031316.000,3734.8585,N,12653.3044,E,1,9,1.03,77.7,M,19.2,M,,*6F
  $GPGGA,031314.000,3734.8585,N,12653.3044,E,1,9,1.03,77.7,M,19.2,M,,*6D
  $GPGGA,031317.000,3734.8585,N,12653.3044,E,1,9,1.11,77.7,M,19.2,M,,*6D
  ```

  



#### 0914

- 실험실 컴퓨터 2대 및 카메라, gps 서버 구동하기
- 특허
  - 아이디어1. 위험도, 환경 학습 기반 PTZ 카메라 제어 (**좀 더 구체적이게 발전시키기**)
    - 위험도 학습이 가능한 엣지가 장착된 PTZ 카메라
    - 위험도 학습 - 유동인구따라 구역마다 위험도 설정
    - 환경  학습 - 시정, 장애물에 따라
    - 학습 구성도
      - 장애물 인지
      - 장애물 학습
      - PTZ 제어 구역 설정
      - 유동인구 인지
      - 유동인구 학습
      - 유동인구에 따른 집중 PTZ 제어구역 설정
      - 유동인구 변화 인지
      - 유동인구 학습
      - 유동인구 변화에 따른 집중 PTZ 제어구역 설정
  - 아이디어2. 무인점포 기반한 아이디어 (**아이디어 도출부터 해야함**)+모빌리티 카메라?
    - 사각지대를 줄일 수 있는 아이디어?
    - 빠르게 대응할 수 있는 아이디어?
  - 아이디어3. 모빌리티, 엣지 기반 아이디어
    - 사생활 보호 기능 드론cctv
      - 객체 검출 및 분류
        - 사람일 경우 - 얼굴 모자이크
      - 특정 이벤트 발생 인지기능
        - 위험 판단
  - 아이디어4. 센서 사용가능한 cctv